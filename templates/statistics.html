{% extends 'base.html' %}

{% block title %}–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ | –û—Å–≤—ñ—Ç–Ω—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫–∞</h1>
    <p class="page-description">–î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ñ</p>
</div>

<!-- –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-container">
    <div class="stat-item">
        <div class="stat-number">{{ total_users }}</div>
        <div class="stat-label">–í—Å—å–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ students }}</div>
        <div class="stat-label">–°—Ç—É–¥–µ–Ω—Ç—ñ–≤</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ teachers }}</div>
        <div class="stat-label">–í–∏–∫–ª–∞–¥–∞—á—ñ–≤</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ total_tests_taken }}</div>
        <div class="stat-label">–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç—ñ–≤</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ avg_score }}%</div>
        <div class="stat-label">–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</div>
    </div>
    <div class="stat-item">
        <div class="stat-number">{{ recent_activity }}</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∑–∞ —Ç–∏–∂–¥–µ–Ω—å</div>
    </div>
</div>

<!-- –¢–æ–ø —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ -->
<div class="card-simple p-4 mb-4">
    <h4 class="mb-3">üèÜ –¢–æ–ø-5 —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤</h4>
    <table class="table data-table">
        <thead>
            <tr>
                <th>–ú—ñ—Å—Ü–µ</th>
                <th>–Ü–º'—è</th>
                <th>–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</th>
                <th>–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç—ñ–≤</th>
            </tr>
        </thead>
        <tbody>
            {% for student in top_students %}
            <tr>
                <td>{{ forloop.counter }}</td>
                <td>{{ student.user__username }}</td>
                <td><span class="badge bg-success">{{ student.avg_score|floatformat:2 }}%</span></td>
                <td>{{ student.tests_count }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- –ù–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à—ñ —Ç–µ—Å—Ç–∏ -->
<div class="card-simple p-4 mb-4">
    <h4 class="mb-3">üìâ –ù–∞–π—Å–∫–ª–∞–¥–Ω—ñ—à—ñ —Ç–µ—Å—Ç–∏</h4>
    <table class="table data-table">
        <thead>
            <tr>
                <th>–ù–∞–∑–≤–∞ —Ç–µ—Å—Ç—É</th>
                <th>–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</th>
                <th>–°–ø—Ä–æ–±</th>
            </tr>
        </thead>
        <tbody>
            {% for test in hardest_tests %}
            <tr>
                <td>{{ test.test__test_name }}</td>
                <td><span class="badge bg-danger">{{ test.avg_score|floatformat:2 }}%</span></td>
                <td>{{ test.attempts }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—É—Ä—Å–∞—Ö -->
<div class="card-simple p-4">
    <h4 class="mb-3">üìö –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫—É—Ä—Å–∞—Ö</h4>
    <table class="table data-table">
        <thead>
            <tr>
                <th>–ö—É—Ä—Å</th>
                <th>–í–∏–∫–ª–∞–¥–∞—á</th>
                <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å —Ç–µ—Å—Ç—ñ–≤</th>
                <th>–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª</th>
            </tr>
        </thead>
        <tbody>
            {% for course in courses_stats %}
            <tr>
                <td>{{ course.course_name }}</td>
                <td>{{ course.teacher.username|default:"–ù–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ" }}</td>
                <td>{{ course.tests_count }}</td>
                <td>
                    {% if course.avg_score %}
                    <span class="badge bg-info">{{ course.avg_score|floatformat:2 }}%</span>
                    {% else %}
                    <span class="badge bg-secondary">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}